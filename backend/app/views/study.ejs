<%#

Copyright (C) 2025 The University of Texas MD Anderson Cancer Center

This file is part of xPEDITE.

xPEDITE is free software: you can redistribute it and/or modify it under the terms of the
GNU General Public License Version 2 as published by the Free Software Foundation.

xPEDITE is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
See the GNU General Public License for more details.

You should have received a copy of the GNU General Public License along with xPEDITE.
If not, see <https://www.gnu.org/licenses/>.

%>

<%- include('header'); %>
    <div class="container">
        <!--
        <input type="button" value="Log Out" class="btn btn-primary btn-sm padbutton" id="logout" style="float: right;">
        -->
        <% if (studyDetail.samples!="empty") { %>
            <!-- <a href="javascript:void(0)" onclick="window.location = window.location.protocol + '//' + window.location.hostname + ':' + window.location.port + '/admin'" style="font-size: 25px;">Show all studies.</a> -->
            <input type="button" class="btn btn-primary btn-sm padbutton" id="back_all_studies" value="Show all studies" />
            <section>
                <label id="studyNameID" class="order-form-label" style="font-size: 25px;"><%= studyDetail.study.study_name %></label>
                </br>
                <label class="order-form-label">PI Last Name:  <%= studyDetail.study.pi_lastname %></label>
                </br>
                <label class="order-form-label">PI First Name:  <%= studyDetail.study.pi_firstname %></label>
                </br>
                <label class="order-form-label">PI Email:  <%= studyDetail.study.pi_email %></label>
                </br>
                <label class="order-form-label">PI Phone:  <%= studyDetail.study.pi_phone %></label>
                </br>
                <label class="order-form-label">Submitter Last Name:  <%= studyDetail.study.submitter_lastname %></label>
                </br>
                <label class="order-form-label">Submitter First Name:  <%= studyDetail.study.submitter_firstname %></label>
                </br>
                <label class="order-form-label">Submitter Email:  <%= studyDetail.study.submitter_email %></label>
                </br>
                <label class="order-form-label">Submitter Phone:  <%= studyDetail.study.submitter_phone %></label>
                </br>
                <label class="order-form-label">Sample Type:  <%= studyDetail.study.sample_type %></label>
                </br>
                <label class="order-form-label">Date:  <%= (studyDetail.study.last_modified.getMonth()+1)+"/"+studyDetail.study.last_modified.getDate()+"/"+studyDetail.study.last_modified.getFullYear() %></label>
                </br>
            </section>
            </br>
            <div class="col-12 mt-3">
                <div id="uploadAnalyzedSection" class="row mt-3 mx-4">
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" name="uploadanalyzedFile" id="uploadanalyzedFile" value="1">
                        <label for="uploadanalyzedFile" class="form-check-label">Click to upload an analyzed data file</label>
                    </div>
                    <div id="uploadanalyzedFileSection" class="row mt-3 mx-4" style="display:none">
                        <form id="uploadanalyzedForm" method="post" action="/submit_data" encType="multipart/form-data">
                            <label class="form-label" for="analyzedFile">Upload analyzed data file</label>
                            <input type="file" name="analyzedFile" class="form-control" id="analyzedFile" />
                            <input type='submit' class="btn btn-dark d-block mx-auto btn-submit" value='Upload' />
                        </form>
                    </div>
                </div>

                <div class="col-12 mb-2">
                    <p id="analyzedFileReady">
                        <%= studyDetail.message %>
                    </p>
                </div>



                <div class="row mt-3 mx-4">
                    <div class="form-group col-12">
                        <label class="display-form-label">Uploaded files</label>
                        <select id="uploaded_files" name="uploaded_files" class="form-control" style="width:30%; display:inline-block">
                                    <% for (var i = 0; i < studyDetail.uploadedFiles.length; i++) { %>
                                    <option value="<%= studyDetail.uploadedFiles[i] %>"><%= studyDetail.uploadedFiles[i] %></option>
                                        <% } %>
                                </select>
                    </div>
                </div>

                <div class="row mt-3 mx-4">
                    <div class="form-group  col-12">
                        <label class="display-form-label">Assay Type</label>
                        <select id="assay_type" name="assay_type" class="form-control" style="width:30%; display:inline-block">
                                <option value="IC-MS Targeted">IC-MS Targeted</option>
                                <option value="IC-MS Non-Targeted">IC-MS Non-Targeted</option>
                                <option value="HILIC-MS">HILIC-MS</option>
                                <option value="C30-MS">C30-MS</option>
                                <option value="Standardized">Standardized</option>
                            </select>
                    </div>
                </div>

                <div class="row mt-3 mx-4">
                    <div class="form-group col-12">
                        <label class="display-form-label">Tools used for analysis</label>
                        <select id="tool_used" name="tool_used" class="form-control" style="width:30%; display:inline-block">
                                <option value="Skyline">Skyline</option>
                                <option value="Trace Finder">Trace Finder</option>
                                <option value="Compound Discoverer">Compound Discoverer</option>
                                <option value="Lipid Search">Lipid Search</option>
                        </select>
                    </div>
                </div>


                <div class="row mt-3 mx-4">
                    <div class="form-group col-12">
                        <label class="display-form-label">Data Normalization Method</label>
                        <select id="normalization_method" name="normalization_method" class="form-control" style="width:30%; display:inline-block">
                                <option value="totalarea">Total Area</option>
                                <option value="median">Median</option>
                                <option value="dna">DNA Concentration</option>
                                <option value="cellCount">Cell Count</option>
                                <option value="tissueWeight">Tissue Weight</option>
                                <option value="no">No Normalization</option>
                                <option value="zscore">Z-Score</option>
                        </select>
                    </div>
                </div>



                <div class="row mt-3 mx-4">
                    <div class="form-group col-12">
                        <label class="display-form-label">Generated Reports</label>
                        <select id="generated_reports" name="generated_reports" class="form-control" style="width:43%; display:inline-block">
                                    <% for (var i = 0; i < studyDetail.reportfiles.length; i++) { %>
                                    <option value="<%= studyDetail.reportfiles[i] %>"><%= studyDetail.reportfiles[i] %></option>
                                        <% } %>
                                </select>
                        <input type="button" value="Show Report" class="btn btn-primary btn-sm" id="showReport">
                        <input type="button" value="Download Report" class="btn btn-primary btn-sm " id="downloadReport">
                        <input type="button" value="Download Logs" class="btn btn-primary btn-sm " id="downloadLogs">
                        <input type="button" value="Remove Report" class="btn btn-primary btn-sm " id="removeReport">
                    </div>
                </div>

                <!-- <div class="form-group  col-12 col-sm-6">
                            <input required class="order-form-input" name="input_file" id="input_file">
                        </div> -->
                <hr>
                <div class="row">

                    <div class="form-group  col-12 ">

                        <% if (studyDetail.message.includes("is ready")) { %>
                            <input type="button" value="Generate Report" class="btn btn-primary btn-sm btn-standout" id="generateReport">
                            <% } else { %>
                                <input type="button" value="Generate Report" class="btn btn-primary btn-sm" id="generateReport" style="display:none">
                                <% } %>
                                    <!-- input type="button" form="adminSampleForm" class="btn btn-primary btn-sm" value="Update Samples Info" id="updateSampleInfo" style="float:right">
                                    <input type="button" value="Delete Column" class="btn btn-primary btn-sm" id="deleteSampleColumn" style="float:right; margin-right: 20px;" -->
                                    <!-- <input type="button" value="Add Column" class="btn btn-primary btn-sm" id="addSampleInfo" style="float:right; margin-right: 20px;"> -->
                                    <!-- input type="button" value="Add Group Column" class="btn btn-primary btn-sm" id="addGroupInfo" style="float:right; margin-right: 20px;">
                                    <input type="button" value="Add Batch Column" class="btn btn-primary btn-sm" id="addBatchInfo" style="float:right; margin-right: 20px;" -->

                                    <!-- Bootstrap modal dialog for report name -->
                                    <div class="modal fade" id="reportNameModal" tabindex="-1" role="dialog">
                                      <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                          <div class="modal-header">
                                            <h5 class="modal-title">Enter Report Name</h5>
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                              <span aria-hidden="true">&times;</span>
                                            </button>
                                          </div>
                                          <div class="modal-body">
                                            <div class="form-group">
                                              <label for="reportNameInput">Report Name:</label>
                                              <input type="text" class="form-control" id="reportNameInput">
                                              <div class="invalid-feedback">
                                                Allowed characters: letters, numbers, underscores, hyphens, periods, and spaces. Name cannot start or end with a hyphen, period, or space. Name cannot end in a space.
                                              </div>
                                            </div>
                                          </div>
                                          <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                            <button type="button" class="btn btn-primary" id="saveReportName">Save</button>
                                          </div>
                                        </div>
                                      </div>
                                    </div>

                    </div>
                </div>
                <div class="col-12 mb-2" id="runStatus" style="border:1px solid black;display:none">
                    <pre><code id="status"></code></pre>
                </div>
                <div class="row" id="spinwheel" style="display:none">
                    <div class="col-12 mb-2">
                        <div class="spinner-border m-3" role="status">
                            <span class="sr-only">Loading...</span>
                        </div>
                    </div>
                </div>
                <div id="sampleTablediv">
                    <%- include('sample_table'); %>
                </div>
            </div>
            <% } %>
    </div>

    <%- include('footer'); %>
