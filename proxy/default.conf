# Copyright (C) 2025 The University of Texas MD Anderson Cancer Center
#
# This file is part of xPEDITE.
#
# xPEDITE is free software: you can redistribute it and/or modify it under the terms of the
# GNU General Public License Version 2 as published by the Free Software Foundation.
#
# xPEDITE is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
# without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
# See the GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License along with xPEDITE.
# If not, see <https://www.gnu.org/licenses/>.

server {

  access_log /logs/access.log main;
  error_log /logs/error.log warn;
  listen 80;
  listen [::]:80 default_server;
  listen 443 ssl http2 default_server;
  listen [::]:443 ssl http2 default_server;
  ssl_certificate /etc/ssl/certs/cert.pem;
  ssl_certificate_key /etc/ssl/certs/key.pem;
  ssl_protocols   TLSv1.2;
  server_name  localhost;
  absolute_redirect off;

  location / {
    proxy_pass http://backend:3000/;
    proxy_set_header Host $http_host;
    proxy_intercept_errors on;
    error_page 401 = @error401;
    # error_page 400 = @error400;
  }

  include /etc/nginx/snippets/ldap-jwt.conf;

}
